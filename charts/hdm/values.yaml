image:
  replicaCount: 1
  repository: ghcr.io/curie-data-factory/hdm
  tag: "2.2.1"
  pullPolicy: IfNotPresent
  name: hdm
  deployRegistry: false
  imagePullSecrets: registrysecret
  dataSecret: |-
    {"auths":{"registry.company.com":{"password":"","username":""}}}

service:
  type: ClusterIP
  targetPort: 80
  protocol: TCP

ingress:
  enabled: true
  hostnames:
  - hdm.company.com
  tls:
  - hosts:
    - hdm.company.com
    secretName: hdm

confLdap:
  key: "conf-ldap.json"
  data: |
    ""

confDb:
  key: "conf-db.json"
  data: |
    ""

confAppli:
  key: "conf-appli.json"
  data: |
    ""

createTable:
  key: "create_tables.sql"
  data: |
    ""

################################################################################
## MYSQL

mysql:

  mysqlRootPassword:
  mysqlReaderPassword:
  mysqlDatabase: hdm
  mysqlUser: hdm
  mysqlPassword:

  auth:
    rootPassword: rootpassword
    database: hdm
    username: hdm
    password: password

  # Init script
  initdbScripts:
    initscript.sql: |-
      CREATE USER 'reader'@'%' IDENTIFIED BY '';
      CREATE USER 'hdmssl'@'%' IDENTIFIED BY '' REQUIRE SSL;

      GRANT ALL PRIVILEGES ON `hdm`.* TO 'hdm'@'%' WITH GRANT OPTION;
      GRANT ALL PRIVILEGES ON `hdm`.* TO 'hdmssl'@'%' WITH GRANT OPTION;
      GRANT SELECT, LOCK TABLES, SHOW VIEW, EVENT, TRIGGER  ON *.* TO 'reader'@'%';

      ALTER USER 'root'@'%' REQUIRE SSL;
      FLUSH PRIVILEGES;

  primary:
    service:
      port: 3306

    persistence:
      size: 20Gi

    configuration: |-
      [mysqld]
      default_authentication_plugin=mysql_native_password
      skip-host-cache
      skip-name-resolve
      explicit_defaults_for_timestamp
      basedir=/opt/bitnami/mysql
      plugin_dir=/opt/bitnami/mysql/plugin
      secure-file-priv=
      local_infile=true
      interactive_timeout=28800
      long_query_time=60.000000
      innodb_buffer_pool_size=2G
      sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION
      innodb_log_file_size = 128M
      innodb_log_buffer_size = 128M
      max_allowed_packet=524288000
      max_connect_errors=30000
      max_connections=500
      connect_timeout=28800
      wait_timeout=28800
      net_read_timeout=28800
      port=3306
      socket=/opt/bitnami/mysql/tmp/mysql.sock
      datadir=/bitnami/mysql/data
      tmpdir=/opt/bitnami/mysql/tmp
      bind-address=0.0.0.0
      pid-file=/opt/bitnami/mysql/tmp/mysqld.pid
      log-error=/opt/bitnami/mysql/logs/mysqld.log
      character-set-server=UTF8
      collation-server=utf8_general_ci

      [client]
      port=3306
      socket=/opt/bitnami/mysql/tmp/mysql.sock
      default-character-set=UTF8
      plugin_dir=/opt/bitnami/mysql/plugin

      [manager]
      port=3306
      socket=/opt/bitnami/mysql/tmp/mysql.sock
      pid-file=/opt/bitnami/mysql/tmp/mysqld.pid

################################################################################
## Kibana

kibana:
  elasticsearchHosts: http://hdm-deployement-elasticsearch-master:9200
  ingress:
    enabled: true
    # annotations:
    #   nginx.ingress.kubernetes.io/server-snippet: |
    #     more_set_headers "Content-Security-Policy: script-src https: 'unsafe-eval' 'unsafe-inline'; object-src 'none'";
    path: /
    hosts:
      - hdm-kibana.company.com
    tls:
      - hosts:
        - hdm-kibana.company.com
        secretName: hdm-kibana

################################################################################
## Elasticsearch

elasticsearch:
  clusterName: "hdm-deployement-elasticsearch"
  ingress:
    enabled: true
    path: /
    hosts:
      - hdm-elastic.company.com
    tls:
      - hosts:
        - hdm-elastic.company.com
        secretName: hdm-elastic
  persistence:
    enabled: false
